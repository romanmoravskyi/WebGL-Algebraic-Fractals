<html>
  <head>
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    />
    <link rel="stylesheet" href="styles.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

    <script id="shader-vs" type="x-shader/x-vertex">
      precision highp float;
      attribute vec2 a_Position;
      void main() {
        gl_Position = vec4(a_Position.x, a_Position.y, 0.0, 1.0);
      }
    </script>

    <script id="shader-fs" type="x-shader/x-fragment">
      precision highp float;

      uniform vec2 u_zoomCenter;
      uniform float u_zoomSize;
      uniform int u_maxIterations;
      uniform int u_fractalType;
      uniform vec2 u_julia_c_value;

      vec2 f(vec2 x, vec2 c) {
        if (u_fractalType == 0) {
          return mat2(x,-x.y,x.x)*x + c;
        }
        else {
          return mat2(x,-x.y,x.x)*x + u_julia_c_value;
        }
      }
      vec3 palette(float t, vec3 a, vec3 b, vec3 c, vec3 d) {
          return a + b*cos( 6.28318*(c*t+d) );
      }
      void main() {
        vec2 uv = gl_FragCoord.xy / vec2(600.0, 600.0);
        vec2 c = u_zoomCenter + (uv * 4.0 - vec2(2.0)) * (u_zoomSize);

        vec2 x;
        if(u_fractalType == 0) {
          x = vec2(0.0);
        }
        else {
          x = c;
        }

        bool escaped = false;
        int iterations = 0;
        for (int i = 0; i < 1000000; i++) {
          if (i > u_maxIterations) break;
          iterations = i;
          x = f(x, c);
          if (length(x) > 2.0) {
            escaped = true;
            break;
          }
        }
        gl_FragColor = escaped ? vec4(palette(float(iterations)/float(u_maxIterations), vec3(0.0),vec3(0.59,0.55,0.75),vec3(0.1, 0.2, 0.3),vec3(0.75)),1.0) : vec4(vec3(0.85, 0.99, 1.0), 1.0);
      }
    </script>

    <script src="fractals.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>

  <body onload="main()">
    <nav class="navbar navbar-expand-lg">
      <div class="collapse navbar-collapse">
        <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
          <li class="nav-item active">
            <a href="fractals.html">
              <img src="images/logo.png" width="40" height="40" />
            </a>
          </li>
        </ul>
        <a style="color:white; margin: 25;" href="mandelbrot.html"
          >Mandelbrot</a
        >
        <a style="color:white; margin: 25;" href="julia.html">Julia</a>
        <a style="color:white; margin: 25;" href="#">Help</a>
      </div>
    </nav>

    <div class="container" style="padding-top: 30px;">
      <div class="row">
        <div class="col-sm-4">
          <div class="card" style="width: 17rem; text-align: center;">
            <div class="card-header" style="font-size: large;">
              Settings
            </div>
            <ul class="list-group list-group-flush">
              <li class="list-group-item">
                <button id="btnRestoreZoom" class="btn btn-dark">
                  Restore zoom
                </button>
              </li>
            </ul>
            <ul class="list-group list-group-flush">
              <li class="list-group-item" style="text-align: left;">
                <div class="custom-file">
                  <input
                    type="file"
                    class="custom-file-input"
                    id="customFile"
                  />
                  <label class="custom-file-label" for="customFile"
                    >Choose pallete file</label
                  >
                </div>
              </li>
            </ul>
            <ul class="list-group list-group-flush">
              <li class="list-group-item">
                <label for="maxIter">Max iterations:</label>
                <input
                  type="number"
                  min="0"
                  step="1"
                  class="form-control"
                  style="text-align: center;"
                  id="maxIter"
                />

                <div
                  class="custom-control custom-checkbox"
                  style="padding: 5px;"
                >
                  <input
                    type="checkbox"
                    class="custom-control-input"
                    id="customCheck"
                    name="autoZoomIter"
                  />
                  <label class="custom-control-label" for="customCheck"
                    >Auto zoom iterations</label
                  >
                </div>
              </li>
            </ul>
            <ul class="list-group list-group-flush">
              <li class="list-group-item">
                <div class="input-group mb-3">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="iterative formule"
                  />
                  <div class="input-group-append">
                    <button class="btn btn-dark">Render</button>
                  </div>
                </div>
              </li>
            </ul>
          </div>
        </div>
        <div class="col-sm-8">
          <canvas
            id="maincanvas"
            width="600"
            height="600"
            style="border:3px solid whitesmoke;"
            >canvas not supported</canvas
          >
        </div>
      </div>
    </div>
  </body>

  <script>
    $(".custom-file-input").on("change", function() {
      var fileName = $(this)
        .val()
        .split("\\")
        .pop();
      $(this)
        .siblings(".custom-file-label")
        .addClass("selected")
        .html(fileName);
    });
  </script>
</html>
